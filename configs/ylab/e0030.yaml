# ==== Preprocessing ==== #
preproc_name: upto500Hz_onlyAUr
debug: False

ecog_data_root: /storage/data/ECoG/E0030/Raw/Mat2k/
face_data_path: /work/data/ECoG/E0030/E0030_*.csv
sync_data_path: /work/data/ECoG/rishido/E0030sync_trigger.csv
processing_sheet_path: /work/data/ECoG/E0030/E0030ProcessingSheet.xlsx

start_subj: 0
end_subj: 18

segment_in_preproc: False # for sweeping over segment length

seq_len: 3 # segment length in seconds
# minimum would be something like 0.1 as video is 30fps and 1/30 = 0.0333,
# then 0.1 can have 3 samples in one segment

# ---- Face ---- #
fps: 30

# ---- Brain---- #
brain_orig_sfreq: 2000
brain_resample_sfreq: 500 # Hz
brain_filter_low: 0.1 # Hz
brain_filter_high: 250 # Hz
clamp_lim: 20 # values after robust scaling
baseline_ratio: 0.2 # ratio compared to segment length
# shift_brain: False
# shift_len: 150 # ms


# ==== Training ==== #
project_name: brain2face_ylab
train_name: test # Will be updated when it's a sweep

dataset: YLabE0030 # YLabGOD / YLabE0030 / UHD / StyleGAN

montage_path: brain2face/utils/montages/E0030/loc.npy
layout: ch_locations_2d
loc_random: False # whether to use montage

F: 256 # 709

reduce_time: True # True -> face is image, False -> face is video

face:
  reduction: mean # extract or mean. Only for reduce_time: True
  encoded: False
  model: OpenFaceMapper
face_encoder:
  in_channels: 17
  hid_dim: 64
  out_channels: ${F}
  ksize_stride: ${final_ksize_stride}
  reduce_time: ${reduce_time}
  fps: ${fps}
  seq_len: ${seq_len}

# Brain Encoder
D1: 270
D2: 320
K: 32
d_drop: 0.3 # Channel distance for spatial dropout
# NOTE: setting these 2 is the key that BrainEncoder downsamples EEG from 120Hz to 30Hz
final_ksize_stride: 2
head_activation: True
time_multiplier: 1

split: deep # shallow / deep / subject_random / subject_each
train_ratio: 0.8
batch_size: 64
lr: 0.005
lr_scheduler: multistep # cosine or multistep
lr_multistep_mlstns: [0.4, 0.6, 0.8, 0.9]
lr_step_gamma: 0.5
epochs: 500
reduction: mean
init_temperature: 5.0

accum_grad: False

chance: False

test_with_whole: False

seed: 1234

cuda_id: 0

sweep_count: 6
sweep_config:
  method: grid
  metric:
    name: test_top10_acc
    goal: maximize
  parameters:
    seq_len:
      values: [0.1, 0.5, 1, 2, 3, 5] # 50ms, 100ms, 500ms, 1s, 2s, 3s
    # loc_random:
    #   values: [True, False]
    # split:
    #   values: [deep, shallow]
    # d_drop:
    #   distribution: uniform
    #   min: 0.2
    #   max: 0.4
    # head_activation:
    #   values: [True, False]
    # final_ksize_stride:
    #   values: [1, 2]
    # face.reduction:
    #   values: [extract, mean]
    # face.type:
    #   values: [static, dynamic]

eval:
  split: shallow
  d_drop: 0.1
  face.encoded: True
  head_activation: False
  final_ksize_stride: 2
  face.reduction: extract